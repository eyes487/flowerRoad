!function(n){"use strict";function e(t,e){this.date=new Date,this.arr_week=["日","一","二","三","四","五","六"],this.left=t.offset().left,this.top="",this.el=t,this.id=t.attr("id"),this._table="",this.readability="",this.defaults={position:"bottom",showToday:!1,showMonth:!1,showYear:!1,type:"day",year:this.date.getFullYear(),month:this.date.getMonth(),day:this.date.getDate(),format:"-",select:function(){},selectMonth:function(){},selectYear:function(){}},this.showType={type:""},this.opt=n.extend({},this.defaults,e),this._year=this.opt.year,e.month&&this.opt.month--,this.init(),this.opt.showToday?this.setInput("day"):this.opt.showMonth?this.setInput("month"):1==this.opt.showYear&&this.setInput("year")}e.prototype={constructor:e,init:function(){var a=this;"day"==this.opt.type?(this.showType.type="day",this.buildNormal(),this.buildNormalDay(),this.el.click(function(t){a._table.toggle(),a.setPosition()})):"month"==this.opt.type?(this.showType.month="month",this.buildNormal(),this.buildMonth(),this.el.click(function(t){a._table.toggle(),a.setPosition(),a._table.find(".lc-prevMonth,.lc-nextMonth").hide()}),this._table.find(".box-header").find(".lc-year").text(this.opt.year+"年")):(this.buildNormal(),this.buildYear(),this.showType.type="year",this._table.find(".box-header .lc-year").text(parseInt(this._year)+"年-"+(parseInt(this._year)+9)+"年"),this.el.click(function(t){a._table.toggle(),a.setPosition(),a._table.find(".lc-prevMonth,.lc-nextMonth").hide()})),n(document).on("click",function(t){for(var e=t.target;e;){if(n(e).hasClass("lc-date")||e.id==a.id)return!1;e=e.parentNode}a._table.hide()}),a._table.on("click",".lc-click[data-role]",function(){a.bindClick[n(this).data("role")].call(a,this)})},arr_day:function(){return[31,this.is_leap(this.opt.year),31,30,31,30,31,31,30,31,30,31]},nowDay:function(){return 0==new Date(this.opt.year,this.opt.month,1).getDay()?7:new Date(this.opt.year,this.opt.month,1).getDay()},is_leap:function(t){return(t%4==0?t%100==0:t%4==0)?29:28},setPosition:function(){"bottom"==this.opt.position?this.top=this.el.offset().top+this.el.outerHeight():this.top=this.el.offset().top-n(".lc-date-"+this.id).outerHeight(),this._table.offset({top:this.top,left:this.el.offset().left})},setInput:function(t){"day"==t?this.readability=this.opt.year+this.opt.format+(this.opt.month<9?"0"+(this.opt.month+1):this.opt.month+1)+this.opt.format+this.opt.day:"month"==t?this.readability=this.opt.year+this.opt.format+(this.opt.month+1<10?"0"+(this.opt.month+1):this.opt.month+1):"year"==t&&(this.readability=this.opt.year),this.el.val(this.readability)},preSetYear:function(){this.buildYear(),this._table.find(".box-header .lc-year").text(parseInt(this._year)+"年-"+(parseInt(this._year)+9)+"年").end().find(".table-year").show()},bindClick:{"next-year":function(){"day"==this.showType.type?(this.opt.year++,this.opt.day="",this.buildNormalDay()):"year"==this.showType.type?(this._year+=10,this.preSetYear()):(this.opt.year++,this._table.find(".lc-year").text(this.opt.year+"年"))},"next-month":function(){this.opt.month++,12==this.opt.month&&(this.opt.month=0,this.opt.year++),this.opt.day="",this.buildNormalDay()},"prev-year":function(){"day"==this.showType.type?(this.opt.year--,this.opt.day="",this.buildNormalDay()):"year"==this.showType.type?(this._year-=10,this.preSetYear()):(this.opt.year--,this._table.find(".lc-year").text(this.opt.year+"年"))},"prev-month":function(){this.opt.month--,-1==this.opt.month&&(this.opt.month=11,this.opt.year--),this.opt.day="",this.buildNormalDay()},"select-year":function(){(0==this._table.find(".table-year").length||this.opt.year<this._year)&&this.buildYear(),this._table.find(".table-year").show().siblings().hide(),this._table.find(".box-header").find(".lc-prevMonth,.lc-nextMonth").hide().end().find(".lc-month").hide(),"top"==this.opt.position&&this.setPosition(),this.showType.type="year",this._table.find(".box-header .lc-year").text(parseInt(this._year)+"年-"+(parseInt(this._year)+9)+"年")},"select-month":function(){0==this._table.find(".table-month").length&&this.buildMonth(),this._table.find(".table-month").show().siblings().hide(),this._table.find(".box-header").find(".lc-prevMonth,.lc-nextMonth").hide().end().find(".lc-month").hide(),"top"==this.opt.position&&this.setPosition(),this._table.find(".box-header").find(".lc-year").text(this.opt.year+"年")},"choose-year":function(t){this.opt.year=parseInt(n(t).text()),n(t).parents(".table-year").find("a").removeClass("td-year-active").end().end().addClass("td-year-active"),this._table.find(".table-month").show().siblings().hide(),"day"==this.opt.type||"month"==this.opt.type?(0==this._table.find(".table-month").length&&this.buildMonth(this.opt),this._table.find(".table-month").show().siblings().hide(),this.showType.type="month",this._table.find(".box-header").find(".lc-year").text(this.opt.year+"年"),"day"==this.opt.type?this.setInput("day"):this.setInput("month")):(this._table.hide(),this.opt.selectYear({readability:this.opt.year.toString()}),this.setInput("year"))},"choose-month":function(t){if(this.opt.month=parseInt(n(t).parent().data("month")),n(t).parents(".table-month").find("a").removeClass("td-month-active").end().end().addClass("td-month-active"),"day"==this.opt.type)this._table.find(".table-day").show().siblings().hide(),this._table.find(".box-header").children().show().siblings(".lc-month").text(this.opt.month+1<10?"0"+(this.opt.month+1)+"月":this.opt.month+1+"月"),"top"==this.opt.position&&this.setPosition(),this.buildNormalDay(),this.showType.type="day",this.setInput("day");else if("month"==this.opt.type){this._table.hide(),this.setInput("month");var e={readability:this.readability};this.opt.selectMonth(e)}},"now-month-day":function(t){this._table.find("table tbody td").removeClass("td-day-active"),n(t).addClass("td-day-active"),this.opt.day="今天"==n(t).text()?(new Date).getDate()<10?"0"+(new Date).getDate():(new Date).getDate():n(t).text()<10?"0"+n(t).text():n(t).text(),this.setInput("day");var e={readability:this.readability};this.opt.select(e),this._table.hide()},"prev-month-day":function(t){this.opt.month--,-1==this.opt.month&&(this.opt.month=11,this.opt.year--),this.opt.day=n(t).text()<10?"0"+n(t).text():n(t).text(),this._table.find("tbody").empty(),this.buildNormalDay(this.opt),this.setInput("day"),this._table.hide()},"next-month-day":function(t){this.opt.month++,12==this.opt.month&&(this.opt.month=0,this.opt.year++),this.opt.day=n(t).text()<10?"0"+n(t).text():n(t).text(),this._table.find("tbody").empty(),this.buildNormalDay(this.opt),this.setInput("day"),this._table.hide()}},buildNormalDay:function(){var t,e=1,a=this.nowDay(this.opt)-1;this._table.find(".table-day tbody").empty();for(var i=0;i<6;i++){for(var o=n("<tr></tr>"),s=0;s<7;s++)if((t=7*i+s-this.nowDay(this.opt)+1)<=0)0==this.opt.month?o.append(n('<td class="td-day-prev lc-click" data-role="prev-month-day">'+(this.arr_day(this.opt)[11]-a)+"</td>")):1==this.opt.month?o.append(n('<td class="td-day-prev lc-click" data-role="prev-month-day">'+(this.arr_day(this.opt)[0]-a)+"</td>")):o.append(n('<td class="td-day-prev lc-click" data-role="prev-month-day">'+(this.arr_day(this.opt)[this.opt.month-1]-a)+"</td>")),a--;else if(t>this.arr_day(this.opt)[this.opt.month])o.append(n('<td class="td-day-next lc-click" data-role="next-month-day">'+e+"</td>")),e++;else{var h=this.readability.split(this.opt.format);h[0]==this.opt.year&&h[1]-1==this.opt.month&&h[2]==t&&this.opt.showToday?h[2]==(new Date).getDate()?o.append(n('<td class="td-day-active td_today lc-click" data-role="now-month-day"></td>').text("今天")):o.append(n('<td class="td-day-active lc-click" data-role="now-month-day"></td>').text(t)):(new Date).getFullYear()==this.opt.year&&(new Date).getMonth()==this.opt.month&&t==(new Date).getDate()?t==this.opt.day&&this.opt.showToday?o.append(n('<td class="td-day-active td_today lc-click" data-role="now-month-day"></td>').text("今天")):o.append(n('<td class="td_today lc-click" data-role="now-month-day"></td>').text("今天")):t==this.opt.day?o.append(n('<td class="td-day-active lc-click" data-role="now-month-day"></td>').text(t)):o.append(n('<td  class="lc-click" data-role="now-month-day"></td>').text(t))}this._table.find(".table-day tbody").append(o),this._table.find(".lc-year").text(this.opt.year+"年"),this._table.find(".lc-month").text(this.opt.month+1<10?"0"+(this.opt.month+1)+"月":this.opt.month+1+"月")}},buildNormal:function(){var t=n('<div class="lc-date lc-date-'+this.id+'"><div class="box-header"><button class="lc-prevYear lc-click" data-role="prev-year"><i class="fa fa-angle-double-left"></i></button><button class="lc-prevMonth lc-click" data-role="prev-month"><i class="fa fa-angle-left"></i></button><span class="lc-year lc-click" data-role="select-year"></span><span class="lc-month lc-click" data-role="select-month"></span><button class="lc-nextYear lc-click" data-role="next-year"><i class="fa fa-angle-double-right"></i></button><button class="lc-nextMonth lc-click" data-role="next-month"><i class="fa fa-angle-right"></i></button></div><div class="box-body"></div></div>'),e=n('<table class="table-day"><thead></thead><tbody></tbody></table>');t.find(".box-body").append(e),n("body").append(t),this._table=n(".lc-date-"+this.id)},buildYear:function(){this._table.find(".table-year").remove();for(var t=n('<table class="table-year"></table>'),e="",a=0;this._year%10!=0;a++)this._year--;for(a=0;a<3;a++){for(var i=n("<tr></tr>"),o=0;o<4&&4*a+o!=10;o++)this._year==this.opt.year?i.append(n('<td><a class="td-year-active lc-click" data-role="choose-year">'+this._year+"</a></td>")):i.append(n('<td><a class="lc-click" data-role="choose-year">'+this._year+"</a></td>")),0==a&&0==o&&(e=this._year),this._year++;this._table.find(".box-body").append(t.append(i))}this._year=e},buildMonth:function(){for(var t=n('<table class="table-month"></table>'),e=["一","二","三","四","五","六","七","八","九","十","十一","十二"],a=0;a<3;a++)for(var i=n("<tr></tr>"),o=0;o<4;o++)4*a+o==parseInt(this.opt.month)?i.append(n('<td><a class="td-month-active lc-click" data-role="choose-month">'+e[4*a+o]+"月</a></td>").data("month",4*a+o)):i.append(n('<td><a class="lc-click" data-role="choose-month">'+e[4*a+o]+"月</a></td>").data("month",4*a+o)),this._table.find(".box-body").append(t.append(i))}},n.fn.buildDate=function(t){return this.each(function(){new e(n(this),t)})}}(window.jQuery);